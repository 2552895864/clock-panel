{"version":3,"sources":["../src/clock_ctrl.js"],"names":[],"mappings":"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","file":"clock_ctrl.js","sourcesContent":["import {PanelCtrl} from 'app/plugins/sdk';\nimport moment from 'moment';\nimport _ from 'lodash';\nimport './css/clock-panel.css!';\n\nconst panelDefaults = {\n  mode: 'time',\n  clockType: '24 hour',\n  offsetFromUtc: null,\n  bgColor: null,\n  countdownSettings: {\n    endCountdownTime: moment().seconds(0).milliseconds(0).add(1, 'day').toDate(),\n    endText: '00:00:00'\n  },\n  dateSettings: {\n    showDate: true,\n    dateFormat: 'YYYY-MM-DD',\n    fontSize: '20px',\n    fontWeight: 'normal'\n  },\n  timeSettings: {\n    customFormat: 'HH:mm:ss',\n    fontSize: '60px',\n    fontWeight: 'normal'\n  }\n};\n\nexport class ClockCtrl extends PanelCtrl {\n  constructor($scope, $injector) {\n    super($scope, $injector);\n    _.defaults(this.panel, panelDefaults);\n    _.defaults(this.panel.timeSettings, panelDefaults.timeSettings);\n\n    if (!(this.panel.countdownSettings.endCountdownTime instanceof Date)) {\n      this.panel.countdownSettings.endCountdownTime = moment(this.panel.countdownSettings.endCountdownTime).toDate();\n    }\n    console.log('#ctor', this.panel.clockType);\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n    this.updateClock();\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/grafana-clock-panel/editor.html', 2);\n  }\n\n  onPanelTeardown() {\n    this.$timeout.cancel(this.nextTickPromise);\n  }\n\n  updateClock() {\n    if (this.panel.mode === 'time') {\n      this.renderTime();\n    } else {\n      this.renderCountdown();\n    }\n\n    this.nextTickPromise = this.$timeout(this.updateClock.bind(this), 1000);\n  }\n\n  renderTime() {\n    let now;\n\n    if (this.panel.offsetFromUtc) {\n      now = moment().utcOffset(parseInt(this.panel.offsetFromUtc, 10));\n    } else {\n      now = moment();\n    }\n\n    if (this.panel.dateSettings.showDate) {\n      this.date = now.format(this.panel.dateSettings.dateFormat);\n    }\n\n    this.time = now.format(this.getTimeFormat());\n  }\n\n  getTimeFormat() {\n    if (this.panel.clockType === '24 hour') {\n      return \"HH:mm:ss\";\n    } else if (this.panel.clockType === '12 hour') {\n      return \"h:mm:ss A\";\n    } else {\n      return this.panel.timeSettings.customFormat;\n    }\n  }\n\n  renderCountdown() {\n    if (!this.panel.countdownSettings.endCountdownTime) {\n      this.time = this.panel.countdownSettings.endText;\n    }\n\n    const now = moment();\n    const timeLeft = moment.duration(moment(this.panel.countdownSettings.endCountdownTime).diff(now));\n    let formattedTimeLeft = '';\n\n    if (timeLeft.asSeconds() <= 0) {\n      this.time = this.panel.countdownSettings.endText;\n      return;\n    }\n\n    if (timeLeft.years() > 0) {\n      formattedTimeLeft = timeLeft.years() === 1 ? '1 year ' : timeLeft.years() + ' years ';\n    }\n    if (timeLeft.months() > 0) {\n      formattedTimeLeft += timeLeft.months() === 1 ? '1 month ' : timeLeft.months() + ' months ';\n    }\n    if (timeLeft.days() > 0) {\n      formattedTimeLeft += timeLeft.days() === 1 ? '1 day ' : timeLeft.days() + ' days ';\n    }\n\n    formattedTimeLeft += moment.utc(timeLeft.asMilliseconds()).format('HH:mm:ss');\n\n    this.time = formattedTimeLeft;\n  }\n}\n\nClockCtrl.templateUrl = 'module.html';\n"]}